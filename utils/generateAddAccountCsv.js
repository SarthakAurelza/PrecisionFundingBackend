const fastcsv = require('fast-csv');
const path = require('path');
const fs = require('fs');

function generateAddAccountCSV(userInfo) {
  const now = new Date();
  const timestamp = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}-${String(now.getSeconds()).padStart(2, '0')}`;

  const data = [{
    add_account: 'add_account',
    ib_id: 'PrecisionFunding',
    account_id: `Aurelza-0001`,
    account_name: 'Sample Account',
    currency: 'USD',
    type: '1',
    customer_firm: 'Customer',
    status: 'Active',
    risk_algorithm: 'Max Loss',
    rms: 'Enabled',
    account_purge_interday: 'Disabled',
    ice_clearing_firm: '',
    ice_clearing_account: '',
    volume_display_code: '',
    ice_account_code: '',
    eurex_clearing_id_code: '',
    eurex_account_type_number: '',
    eurex_account_type_code: '',
    liffe_account_type_code: '',
    liffe_eq_account_type_code: '',
    matif_account_type_code: '',
    aex_account_type_code: '',
    nymex_omnibus_account: '',
    cme_omnibus_account: '',
    fxms_omnibus_account: '',
    nlx_omnibus_account: '',
    kcbt_omnibus_account: '',
    mgex_omnibus_account: '',
    wce_omnibus_account: '',
    liffe_omnibus_account: '',
    liffe_eq_omnibus_account: '',
    matif_omnibus_account: '',
    eurex_omnibus_account: '',
    ice_omnibus_account: '',
    dme_omnibus_account: '',
    aex_omnibus_account: '',
    hsfx_omnibus_account: '',
    cme_giveup_firm: '',
    cme_cmta_giveup_cd: '',
    nymex_giveup_firm: '',
    nymex_cmta_giveup_cd: '',
    dme_customer_firm: '',
    dme_cti: '',
    dme_clearing_firm: '',
    hsfx_account_owner: '',
    btec_omnibus_account: '',
    fxcm_omnibus_account: '',
    fxcm_r_omnibus_account: '',
    cboe_omnibus_account: '',
    cfe_omnibus_account: '',
    cbsx_omnibus_account: '',
    cboe_clearing_firm: '',
    one_c_clearing_firm: '',
    cfe_clearing_firm: '',
    cbsx_clearing_firm: '',
    cboe_clearing_account: '',
    one_c_clearing_account: '',
    cfe_clearing_account: '',
    cbsx_clearing_account: '',
    cboe_order_capacity: '',
    one_c_order_capacity: '',
    cfe_order_capacity: '',
    cbsx_order_capacity: '',
    cboe_executing_broker: '',
    one_c_executing_broker: '',
    cfe_executing_broker: '',
    cbsx_executing_broker: '',
    one_c_omnibus_account: '',
    meff_omnibus_account: '',
    bats_omnibus_account: '',
    bats_order_capacity: '',
    bats_clearing_firm: '',
    bats_clearing_account: '',
    mx_omnibus_account: '',
    gft_omnibus_account: '',
    bmf_omnibus_account: '',
    bmf_giveup_firm: '',
    bmf_cmta_giveup_cd: '',
    ullink_omnibus_account: '',
    sgx_omnibus_account: '',
    finra_member_type_code: '',
    finra_account_type_code: '',
    cfe_optional_clearing_data: '',
    cboe_optional_clearing_data: '',
    cbsx_optional_clearing_data: '',
    one_c_optional_clearing_data: '',
    nymex_clearing_firm_id: '',
    btec_clearing_firm_id: '',
    cme_clearing_firm_id: '',
    nlx_clearing_firm_id: '',
    kcbt_clearing_firm_id: '',
    mgex_clearing_firm_id: '',
    wce_clearing_firm_id: '',
    liffe_clearing_firm_id: '',
    liffe_eq_clearing_firm_id: '',
    matif_clearing_firm_id: '',
    eurex_clearing_firm_id: '',
    ice_clearing_firm_id: '',
    jade_clearing_firm_id: '',
    dme_clearing_firm_id: '',
    aex_clearing_firm_id: '',
    nybot_clearing_firm_id: '',
    fxcm_clearing_firm_id: '',
    fxcm_r_clearing_firm_id: '',
    bmf_clearing_firm_id: '',
    cboe_clearing_firm_id: '',
    cfe_clearing_firm_id: '',
    cbsx_clearing_firm_id: '',
    one_c_clearing_firm_id: '',
    mx_clearing_firm_id: '',
    bats_clearing_firm_id: '',
    meff_clearing_firm_id: '',
    gft_clearing_firm_id: '',
    forts_clearing_firm_id: '',
    arca_clearing_firm_id: '',
    rts_clearing_firm_id: '',
    idem_clearing_firm_id: '',
    sgx_clearing_firm_id: '',
    rts_omnibus_account: '',
    mx_account_type_code: '',
    idem_account_type_code: '',
    ice_otc_omnibus_account: '',
    ice_otc_clearing_firm: '',
    ice_otc_clearing_account: '',
    ice_otc_account_code: '',
    nybot_omnibus_account: '',
    nybot_clearing_firm: '',
    nybot_clearing_account: '',
    nybot_account_code: '',
    nybot_cti_code: '',
    wce_clearing_firm: '',
    wce_clearing_account: '',
    wce_account_code: '',
    wce_cti_code: '',
    lme_omnibus_account: '',
    lme_clearing_firm_id: '',
    cbot_clearing_firm_id: '',
    cbot_omnibus_account: '',
    cbot_giveup_firm: '',
    cbot_cmta_giveup_cd: '',
    comex_clearing_firm_id: '',
    comex_omnibus_account: '',
    comex_giveup_firm: '',
    comex_cmta_giveup_cd: '',
    krx_clearing_firm_id: '',
    krx_omnibus_account: '',
    krx_giveup_firm: '',
    krx_cmta_giveup_cd: '',
    equity_commission_structure: '',
    byx_clearing_firm_id: '',
    byx_omnibus_account: '',
    byx_order_capacity: '',
    byx_clearing_firm: '',
    byx_clearing_account: '',
    equity_option_commission_structure: '',
    account_salesperson: '',
    equity_commission_application_frequency: '',
    option_futures_enabled: '',
    mtom_flag: '',
    mexder_clearing_firm_id: '',
    mexder_omnibus_account: '',
    mexder_giveup_firm: '',
    mexder_cmta_giveup_cd: '',
    cme_giveup_account: '',
    nymex_giveup_account: '',
    bmf_giveup_account: '',
    cbot_giveup_account: '',
    comex_giveup_account: '',
    krx_giveup_account: '',
    mexder_giveup_account: '',
    arca_omnibus_account: '',
    arca_order_capacity: '',
    nlx_account_type_code: '',
    auto_liquidate: '',
    auto_liquidate_criteria: '',
    auto_liquidate_threshold: '',
    tdex_clearing_firm_id: '',
    tdex_omnibus_account: '',
    tdex_account_type_code: '',
    green_clearing_firm_id: '',
    green_omnibus_account: '',
    green_giveup_firm: '',
    green_cmta_giveup_cd: '',
    green_giveup_account: '',
    ose_clearing_firm_id: '',
    ose_omnibus_account: '',
    ose_account_type_code: '',
    ose_account_type_number: '',
    mgex_cbot_giveup_firm: '',
    mgex_cbot_cmta_giveup_cd: '',
    mgex_cbot_giveup_account: '',
    nymex_dme_giveup_firm: '',
    nymex_dme_cmta_giveup_cd: '',
    nymex_dme_giveup_account: '',
    mgex_cbot_clearing_firm_id: '',
    mgex_cbot_omnibus_account: '',
    nymex_dme_clearing_firm_id: '',
    nymex_dme_omnibus_account: '',
    includes_commission_in_published_pnl: '',
    equity_account_ownership: '',
    eurex_order_capacity: '',
    kcbt_cbot_clearing_firm_id: '',
    kcbt_cbot_account_type: '',
    kcbt_cbot_customer_firm: '',
    kcbt_cbot_omnibus_account: '',
    kcbt_cbot_giveup_firm: '',
    kcbt_cbot_cmta_giveup_cd: '',
    kcbt_cbot_giveup_account: '',
    mgex_cbot_account_type: '',
    mgex_cbot_customer_firm: '',
    nymex_dme_account_type: '',
    nymex_dme_customer_firm: '',
    nadex_account_type: '',
    nadex_omnibus_account: '',
    nadex_clearing_firm_id: '',
    nlx_account_type: '',
    matif_account_type: '',
    aex_account_type: '',
    liffe_account_type: '',
    liffe_eq_account_type: '',
    cme_account_type: '',
    nymex_account_type: '',
    mgex_account_type: '',
    kcbt_account_type: '',
    bmf_account_type: '',
    dme_account_type: '',
    cbot_account_type: '',
    comex_account_type: '',
    krx_account_type: '',
    mexder_account_type: '',
    klse_account_type: '',
    nlx_customer_firm: '',
    matif_customer_firm: '',
    aex_customer_firm: '',
    liffe_customer_firm: '',
    liffe_eq_customer_firm: '',
    cme_customer_firm: '',
    nymex_customer_firm: '',
    mgex_customer_firm: '',
    kcbt_customer_firm: '',
    bmf_customer_firm: '',
    cbot_customer_firm: '',
    comex_customer_firm: '',
    krx_customer_firm: '',
    mexder_customer_firm: '',
    klse_customer_firm: '',
    mgex_kcbt_clearing_firm_id: '',
    mgex_kcbt_account_type: '',
    mgex_kcbt_customer_firm: '',
    mgex_kcbt_omnibus_account: '',
    mgex_kcbt_giveup_firm: '',
    mgex_kcbt_cmta_giveup_cd: '',
    mgex_kcbt_giveup_account: '',
    disable_on_auto_liquidate: '',
    edgx_clearing_firm_id: '',
    edgx_order_capacity: '',
    edgx_omnibus_account: '',
    quoting_exchange: '',
    self_match_prevention_id: '',
    exclude_from_position_load: '',
    iex_order_capacity: '',
    iex_omnibus_account: '',
    iex_clearing_firm_id: '',
    cme_self_match_prevention_id: '',
    cbot_self_match_prevention_id: '',
    comex_self_match_prevention_id: '',
    nymex_self_match_prevention_id: '',
    mgex_self_match_prevention_id: '',
    mexder_self_match_prevention_id: '',
    bmf_self_match_prevention_id: '',
    nymex_dme_self_match_prevention_id: '',
    mgex_cbot_self_match_prevention_id: '',
    eurex_self_match_prevention_id: '',
    cme_rms_at_exchange_gateway: '',
    cbot_rms_at_exchange_gateway: '',
    comex_rms_at_exchange_gateway: '',
    nymex_rms_at_exchange_gateway: '',
    long_options_only_please: '',
    risk_management_at_exchange_gateway: '',
    account_expiry_limit: '',
    auto_liquidate_max_min_account_balance: '',
    liffe_clearing_firm: '',
    liffe_clearing_account: '',
    liffe_account_code: '',
    liffe_cti_code: '',
    margin_percentage: '',
    default_commission: '',
    min_margin_rate: '',
    min_spread_margin: '',
    spread_margin_percentage: '',
    cfe_self_match_prevention_id: '',
    cfe_customer_firm: '',
    cfe_cti_code: '',
    lmax_omnibus_account: '',
    option_margin_percentage: '',
    min_option_margin: '',
    overnight_margin_percentage: '',
    overnight_option_margin_percentage: '',
    overnight_spread_margin_percentage: '',
    quantity_limits_for_smac: '',
    restrict_products_for_smac: 'Enabled',
    liquidating_only: 'Enabled',
    auto_liquidate_ignore_open_pnl_when_trailing: 'Disabed',
    smfe_omnibus_account: 'value',
    smfe_customer_firm: 'Customer',
    smfe_account_type: 'Own Account',
    gain_omnibus_account: 'value',
    use_min_account_balance: 'Enabled',
    use_account_loss_limit: 'Enabled',
    use_product_loss_limit: 'Enabled',
    master_client_master_balance: 'Master',
    master_client_master_account: 'Client',
    master_client_balance_percentage: '0.',
    master_client_balance_ceiling: '00000.',
    master_client_shared_balance: '0000.',
    ice_self_match_prevention_id: 'SMP123',
    nybot_self_match_prevention_id: 'SMP124',
    liffe_self_match_prevention_id: 'SMP125',
    wce_self_match_prevention_id: 'SMP126',
    ice_otc_self_match_prevention_id: 'SMP127',
    nasdaq_order_capacity: 'Agency',
    nasdaq_giveup_firm: 'value',
    nasdaq_omnibus_account: 'value',
    fairx_omnibus_account: 'value',
    fairx_customer_firm: 'Agency',
    fairx_cti_code: 'Own Account',
    fairx_self_match_prevention_id: 'SMP128',
    fairx_clearing_firm_id: 'value',
    cme_cbot_clearing_firm_id: 'value',
    cme_cbot_account_type: 'value',
    cme_cbot_customer_firm: 'Customer',
    cme_cbot_omnibus_account: 'value',
    cme_cbot_giveup_firm: 'value',
    cme_cbot_cmta_giveup_cd: 'value',
    cme_cbot_giveup_account: 'value',
    cme_cbot_self_match_prevention_id: 'SMP129',
    crosstower_omnibus_account: 'value',
    crosstower_clearing_firm_id: 'value',
    liquidate_only_on_auto_liquidate: 'Enabled',
    tbill_haircut_percentage: '.',
    overnight_tbill_haircut_percentage: '.',
    pattern_day_trader_instant_buying_power_update: 'Yes',
    ignore_product_qty_limits: 'No',
  }];

  const dirPath = './csv_files/add_account';
  const fileName = `${data[0].user_id}_${timestamp}.csv`;
  const filePath = path.join(dirPath,fileName);
  if (!fs.existsSync(dirPath)) {
    fs.mkdirSync(dirPath, { recursive: true });
  }

  const ws = fs.createWriteStream(filePath);

  fastcsv
    .write(data, { headers: false })
    .pipe(ws);

  return {filePath, fileName};
}

module.exports={
    generateAddAccountCSV
}